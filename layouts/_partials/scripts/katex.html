{{/* load stylesheet for KaTeX support */ -}}

{{ $version := .Site.Params.katex.version | default "latest" -}}

{{ $katex_css_url := printf "https://cdn.jsdelivr.net/npm/katex@%s/dist/katex%s.css" $version (cond hugo.IsProduction ".min" "") -}}

{{ with try (resources.GetRemote $katex_css_url) -}}
  {{ with .Err -}}
    {{ errorf "Could not retrieve KaTeX css file from CDN. Reason: %s." . -}}
  {{ else with.Value -}}
    {{ with resources.Copy (printf "css/katex%s.css" (cond hugo.IsProduction ".min" "")) . }}
      {{ $secureCSS := . | resources.Fingerprint "sha512" -}}
<link rel="stylesheet" href="{{- .RelPermalink -}}" integrity="{{- $secureCSS.Data.Integrity -}}" crossorigin="anonymous">
    {{ end -}}
  {{ end -}}
{{ else -}}
  {{ errorf "Invalid KaTeX version %s, could not retrieve this version from CDN." $version -}}
{{ end -}}
