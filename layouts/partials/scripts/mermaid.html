{{ $version := cond ( ge hugo.Version "0.90.0" ) "latest" "9.3.0" -}}
{{ with .Site.Params.mermaid.version -}}
{{ $version = . -}}
{{ end -}}

{{ $cdnurl := printf "https://cdn.jsdelivr.net/npm/mermaid@%s/dist/mermaid.min.js" $version -}}
{{ if ge hugo.Version "0.90.0" -}}
{{ $mermaidjs := resources.GetRemote $cdnurl -}}
{{ if eq $mermaidjs nil -}}
{{ errorf "Invalid Mermaid version %s, could not retrieve this version from CDN" $version -}}
{{ else -}}
{{ $mermaidsecure := $mermaidjs | resources.Fingerprint "sha512" -}}
<script type="text/javascript" src="{{ $mermaidsecure.Permalink }}" integrity="{{ $mermaidsecure.Data.Integrity -}}">
</script>
{{ end }}
{{ else -}}
<script src="{{- $cdnurl -}}" integrity="sha512-ku2nmBrzAXY5YwohzTqLYH1/lvyMrpTVxgQKrvTabd/b/uesqltLORdmpVapYv6QhZVCLUX6wkvFaKOAY4xpUA==" crossorigin="anonymous"></script>
{{ warnf "Outdated Hugo version %s, consider upgrading to make full use of all theme features" hugo.Version -}}
{{ end -}}
